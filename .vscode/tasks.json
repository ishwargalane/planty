{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Build",
            "type": "shell",
            "command": "if [ -f \"/opt/esp/idf/export.sh\" ]; then source /opt/esp/idf/export.sh && idf.py build; else docker run --rm -v \"$(pwd)\":/workspaces/planty -v \"$HOME/.espressif/esp-rainmaker\":/opt/esp/rainmaker -e RMAKER_PATH=/opt/esp/rainmaker -w /workspaces/planty esp-rainmaker-build /bin/bash -c \"source /opt/esp/idf/export.sh && idf.py build\"; fi",
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "problemMatcher": [
                "$gcc"
            ]
        },
        {
            "label": "Flash",
            "type": "shell",
            "command": "if [ -f \"/opt/esp/idf/export.sh\" ]; then source /opt/esp/idf/export.sh && idf.py -p ${input:serialPort} flash; else docker run --rm -v \"$(pwd)\":/workspaces/planty -v \"$HOME/.espressif/esp-rainmaker\":/opt/esp/rainmaker -e RMAKER_PATH=/opt/esp/rainmaker -w /workspaces/planty --device=${input:serialPort} esp-rainmaker-build /bin/bash -c \"source /opt/esp/idf/export.sh && idf.py -p ${input:serialPort} flash\"; fi",
            "group": "test",
            "problemMatcher": []
        },
        {
            "label": "Monitor",
            "type": "shell",
            "command": "if [ -f \"/opt/esp/idf/export.sh\" ]; then source /opt/esp/idf/export.sh && idf.py -p ${input:serialPort} monitor; else docker run --rm -v \"$(pwd)\":/workspaces/planty -v \"$HOME/.espressif/esp-rainmaker\":/opt/esp/rainmaker -e RMAKER_PATH=/opt/esp/rainmaker -w /workspaces/planty --device=${input:serialPort} esp-rainmaker-build /bin/bash -c \"source /opt/esp/idf/export.sh && idf.py -p ${input:serialPort} monitor\"; fi",
            "group": "test",
            "problemMatcher": []
        },
        {
            "label": "Flash and Monitor",
            "type": "shell",
            "command": "if [ -f \"/opt/esp/idf/export.sh\" ]; then source /opt/esp/idf/export.sh && idf.py -p ${input:serialPort} flash monitor; else docker run --rm -v \"$(pwd)\":/workspaces/planty -v \"$HOME/.espressif/esp-rainmaker\":/opt/esp/rainmaker -e RMAKER_PATH=/opt/esp/rainmaker -w /workspaces/planty --device=${input:serialPort} esp-rainmaker-build /bin/bash -c \"source /opt/esp/idf/export.sh && idf.py -p ${input:serialPort} flash monitor\"; fi",
            "group": "test",
            "problemMatcher": []
        },
        {
            "label": "Clean",
            "type": "shell",
            "command": "if [ -f \"/opt/esp/idf/export.sh\" ]; then source /opt/esp/idf/export.sh && idf.py fullclean; else docker run --rm -v \"$(pwd)\":/workspaces/planty -v \"$HOME/.espressif/esp-rainmaker\":/opt/esp/rainmaker -e RMAKER_PATH=/opt/esp/rainmaker -w /workspaces/planty esp-rainmaker-build /bin/bash -c \"source /opt/esp/idf/export.sh && idf.py fullclean\"; fi",
            "group": "test",
            "problemMatcher": []
        },
        {
            "label": "Menuconfig",
            "type": "shell",
            "command": "if [ -f \"/opt/esp/idf/export.sh\" ]; then source /opt/esp/idf/export.sh && idf.py menuconfig; else docker run --rm -it -v \"$(pwd)\":/workspaces/planty -v \"$HOME/.espressif/esp-rainmaker\":/opt/esp/rainmaker -e RMAKER_PATH=/opt/esp/rainmaker -w /workspaces/planty esp-rainmaker-build /bin/bash -c \"source /opt/esp/idf/export.sh && idf.py menuconfig\"; fi",
            "group": "test",
            "problemMatcher": []
        },
        {
            "label": "List Serial Ports",
            "type": "shell",
            "command": "if [[ \"$(uname)\" == \"Darwin\" ]]; then echo \"Available Serial Ports:\" && ls -l /dev/tty.* | grep -i usb || echo \"No USB serial devices found\"; elif [[ \"$(uname)\" == \"Linux\" ]]; then echo \"Available Serial Ports:\" && ls -l /dev/ttyUSB* /dev/ttyACM* 2>/dev/null || echo \"No USB serial devices found\"; else echo \"Available Serial Ports:\" && powershell -Command \"Get-WmiObject Win32_SerialPort | Select-Object DeviceID, Description\"; fi",
            "group": "test",
            "problemMatcher": []
        }
    ],
    "inputs": [
        {
            "id": "serialPort",
            "type": "promptString",
            "description": "Serial port (e.g., /dev/tty.usbserial-X or COM3)",
            "default": "/dev/tty.usbserial-0001"
        }
    ]
} 